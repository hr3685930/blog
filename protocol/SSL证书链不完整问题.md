# SSL证书链不完整问题

## 问题
给客户部署完TMS系统终端后，出现不能连接到TMS系统问题。经排查发现客户购买的终端设备(p1-4g)偶尔能访问https域名的tms服务，但是其他智能设备可以访问。

## 排查过程
最开始排查程序问题，经测试本地一切正常。随后拉委员会沟通问题，可能是ssl证书机构设备不支持或者是证书链问题，经排查客户的机器上支持该证书机构，并发现客户给的cert证书文件中没包含一个完整到可以被浏览器内置数据验证的证书链，导致访问https被拒绝。

解决工具:
修复证书链网址:  [https://myssl.com/chain_download.html](https://myssl.com/chain_download.html) 

## 解释
1. 何为证书链
证书发行商们为了安全，通常会将这些根证书对应的私钥保存在绝对断网的金库里。在金库里用这些根私钥，签发一些“中级”证书，这些中级证书的私钥拥有签发再下一级证书的权限。这些中级私钥被安装到在线服务器上，通过签发网站证书来赚钱。一旦这些服务器被黑，发行商就可以利用金库里物理隔离的根证书私钥，可以签发吊销令，消灭这些中级证书的信任，而不必让各家浏览器彻底不信任这家发行商的根证书。再签一条新的中级发行证书

2. 为什么其他设备能访问或者偶尔能访问
有2种情况:
A. 浏览器自安装以来，从未见过这个证书。那么验证会失败。
B. 浏览器以前见过、并且验证过，那么验证会成功。通常管理员自己会去证书发行商的https网站买证书，浏览器就会验证，然后将验证成功的中间证书全都缓存下来，为以后节省时间。当管理员（错误地）配置完自己的网站，去浏览测试的时候，完全不会遇到问题。因为他的浏览器已经认识这个中间证书了。